services:
  backend:
    build:
      context: ../backend
    container_name: catchdash-backend
    environment:
      CATCHDASH_APP_ENV: dev
      CATCHDASH_TOPICS_CONFIG_PATH: config/topics.yaml
      CATCHDASH_TOPIC_CACHE_TTL_SECONDS: "30"
    ports:
      - "8080:8080"

  frontend:
    build:
      context: ../frontend
    container_name: catchdash-frontend
    environment:
      VITE_BACKEND_BASE_URL: ${VITE_BACKEND_BASE_URL:-http://localhost:8080}
    ports:
      - "5174:5174"
    depends_on:
      - backend

  kokoro:
    image: ghcr.io/remsky/kokoro-fastapi-cpu:v0.2.1
    container_name: catchdash-kokoro
    ports:
      - "8880:8880"

  worker:
    build:
      context: ../worker
    container_name: catchdash-worker
    environment:
      CATCHDASH_WORKER_BACKEND_BASE_URL: http://backend:8080
      CATCHDASH_WORKER_KOKORO_BASE_URL: http://kokoro:8880
      CATCHDASH_WORKER_LLM_PROVIDER: ${CATCHDASH_WORKER_LLM_PROVIDER:-ollama}
      CATCHDASH_WORKER_LLM_BASE_URL: ${CATCHDASH_WORKER_LLM_BASE_URL:-}
      CATCHDASH_WORKER_LLM_API_KEY: ${CATCHDASH_WORKER_LLM_API_KEY:-}
      CATCHDASH_WORKER_LLM_MODEL: ${CATCHDASH_WORKER_LLM_MODEL:-qwen3:4b}
      CATCHDASH_WORKER_OLLAMA_BASE_URL: ${CATCHDASH_WORKER_OLLAMA_BASE_URL:-http://host.docker.internal:11434}
      CATCHDASH_WORKER_OLLAMA_MODEL: ${CATCHDASH_WORKER_OLLAMA_MODEL:-qwen3:4b}
      CATCHDASH_WORKER_TTS_VOICE: ${CATCHDASH_WORKER_TTS_VOICE:-af_heart}
      CATCHDASH_WORKER_POLL_SECONDS: "2"
      CATCHDASH_WORKER_WORKER_ID: worker-1
    extra_hosts:
      - "host.docker.internal:host-gateway"
    depends_on:
      - backend
      - kokoro
